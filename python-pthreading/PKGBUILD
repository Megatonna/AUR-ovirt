# Contributor: Andrii Sokolenko
pkgbase=(pthreading-git)
pkgname=(python2-pthreading python-pthreading)
pkgver=0.15.gitcad4584
pkgrel=1
pkgdesc="Reimplement threading.Lock, RLock, and Condition with libpthread."
arch=('i686' 'x86_64')
url="https://github.com/oVirt/pthreading"
license=('GPLv2+')
groups=()
conflicts=()
replaces=()
backup=()
options=(!emptydirs)
install=()
source=('git+https://gerrit.ovirt.org/p/pthreading.git')
sha256sums=('SKIP')
makedepends=('python' 'python2')
checkdepends=('python-tox' 'python2-tox' 'python-pytest' 'python2-pytest')
prepare() {
  mkdir -p build-{python2,python}
  grep -Rle "#\!/usr/bin/python" * | xargs -r sed -ie 's/#!\/usr\/bin\/\bpython\b/\#!\/usr\/bin\/python2/g'
  grep -Rle "/usr/bin/env python" * | xargs -r sed -ie 's/\/usr\/bin\/env \bpython\b/\/usr\/bin\/env python2/g'
}
check() {
  cd ${srcdir}/${pkgbase%%-git}
  LC_CTYPE=en_US.UTF-8 tox 
  LC_CTYPE=en_US.UTF-8 tox2
}

package_python2-pthreading() {
depends=('python2')
cd ${srcdir}/${pkgbase%%-git}
python2 setup.py build -b ${srcdir}/build-python2 install -O1 --root=${pkgdir} --prefix=/usr
}

package_python-pthreading() {
provides=("python3-pthreading")
depends=('python3')
cd ${srcdir}/${pkgbase%%-git}
python3 setup.py build -b ${srcdir}/build-python install -O1 --root=${pkgdir} --prefix=/usr
}

# vim:set ts=2 sw=2 et:
