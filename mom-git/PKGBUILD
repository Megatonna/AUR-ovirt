# Contributor: Andrii Sokolenko
# Based by Ovirt mom.spec
pkgname=mom-git
pkgver=0.5.10.dfea878
pkgrel=1
pkgdesc="Dynamically manage system resources on virtualization hosts"
arch=('i686' 'x86_64')
url="http://www.ovirt.org/develop/projects/mom/"
license=('GPLv2')
groups=()
depends=('python2' 'python2-nose' 'python2-mock' 'systemd' 'libvirt' 'libvirt-python2' 'procps-ng')
makedepends=('')
provides=('mom')
conflicts=()
replaces=()
backup=()
options=(!emptydirs)
install=$pkgname.install
source=('git+https://gerrit.ovirt.org/mom.git')
sha256sums=('SKIP')

_systemddir=/usr/lib/systemd

build() {
  cd ${srcdir}/${pkgname%%-git}
  export PYTHON="$(which python2)"
  autoreconf -if
  ./configure --prefix=/usr --sbindir=/usr/bin
  grep -Rle "/usr/bin/env python" * | xargs sed -ie 's/\/usr\/bin\/env \bpython\b/\/usr\/bin\/env python2/g'
  make
}

package() {
  cd ${srcdir}/${pkgname%%-git}
  make DESTDIR="$pkgdir" LIBDIR="/usr/lib" BINDIR="/usr/bin" install
  #systemd
  install -D -m 0644 contrib/momd.service $pkgdir/$_systemddir/system/momd.service
  install -D -m 0644 doc/mom-balloon+ksm.conf $pkgdir/etc/momd.conf
}

# vim:set ts=2 sw=2 et:
